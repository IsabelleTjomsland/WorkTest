@page "/create-device"
@inject HttpClient Http
@inject NavigationManager Navigation

<h3>Create a New Device</h3>

<div class="mt-4">
    <div class="mb-3">
        <label for="deviceName">Name:</label>
        <input type="text" id="deviceName" @bind="newDevice.Name" class="form-control" />
    </div>

    <div class="mb-3">
        <label for="deviceStatus">Status:</label>
        <div class="form-check form-switch">
            <input type="checkbox" id="deviceStatus" @bind="newDevice.Status" class="form-check-input" />
        </div>
    </div>

    <!-- Buttons aligned next to each other -->
    <div class="d-flex justify-content-start mt-3">
        <button class="btn btn-primary me-2" @onclick="OnCreateDevice">Create</button>
        <button class="btn btn-secondary" @onclick="OnCancel">Cancel</button>
    </div>
</div>

@code {
    /// <summary>
    /// A new device object that the user is creating.
    /// </summary>
    private Device newDevice = new Device();

    /// <summary>
    /// This method is triggered when the user clicks the "Create" button.
    /// It sends an HTTP POST request to the backend to create a new device.
    /// </summary>
    private async Task OnCreateDevice()
    {
        try
        {
            // Send HTTP POST request to create a new device
            var response = await Http.PostAsJsonAsync("http://localhost:5246/api/devices", newDevice);

            if (response.IsSuccessStatusCode)
            {
                // Only navigate to the list after the device is successfully created
                Navigation.NavigateTo("/devices-management"); // Redirect after successful creation
            }
            else
            {
                var errorContent = await response.Content.ReadAsStringAsync();
                Console.WriteLine($"Failed to create device: {response.StatusCode} - {errorContent}");
            }
        }
        catch (Exception ex)
        {
            // Log any error that occurs during the creation process
            Console.WriteLine($"Error creating device: {ex.Message}");
        }
    }

    /// <summary>
    /// This method is triggered when the user clicks the "Cancel" button.
    /// It navigates the user back to the devices management page without making any changes.
    /// </summary>
    private void OnCancel()
    {
        // Navigate to the list of devices without making changes
        Navigation.NavigateTo("/devices-management");
    }

    /// <summary>
    /// Represents a device with an ID, Name, and Status.
    /// </summary>
    public class Device
    {
        /// <summary>
        /// The unique identifier of the device. This will be auto-generated by the backend.
        /// </summary>
        public int Id { get; set; }

        /// <summary>
        /// The name of the device.
        /// </summary>
        public string Name { get; set; }

        /// <summary>
        /// The status of the device (true if the device is on, false if it is off).
        /// </summary>
        public bool Status { get; set; }
    }
}

@page "/device-details"
@inject HttpClient Http
@inject NavigationManager Navigation

<h3>Device Details</h3>

@if (device == null)
{
    <p>Loading...</p>
}
else
{
    <div class="card p-3">
        <p><strong>ID:</strong> @device.Id</p>
        <p><strong>Name:</strong> @device.Name</p>
        <p><strong>Status:</strong> @(device.Status ? "On" : "Off")</p>

        <!-- Buttons aligned next to each other -->
        <div class="d-flex justify-content-start mt-3">
            <button class="btn btn-primary me-2" @onclick="() => NavigateToEdit(device.Id)">Edit</button>
            <button class="btn btn-secondary" @onclick="NavigateBack">Back to List</button>
        </div>
    </div>
}

@code {
    private Device device;

    protected override async Task OnInitializedAsync()
    {
        var uri = new Uri(Navigation.Uri);
        var query = System.Web.HttpUtility.ParseQueryString(uri.Query);
        var idString = query.Get("id");

        if (int.TryParse(idString, out int deviceId))
        {
            try
            {
                device = await Http.GetFromJsonAsync<Device>($"http://localhost:5246/api/devices/{deviceId}");
            }
            catch (Exception ex)
            {
                Console.WriteLine($"Error fetching device: {ex.Message}");
            }
        }
    }

    private void NavigateToEdit(int id) => Navigation.NavigateTo($"/edit-device?id={id}");
    private void NavigateBack() => Navigation.NavigateTo("/devices-management");

    public class Device
    {
        public int Id { get; set; }
        public string Name { get; set; }
        public bool Status { get; set; }
    }
}
